<!DOCTYPE html><html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Türkçe Medya Oynatıcı</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      background-color: #121212;
      color: #fff;
    }
    .sidebar {
      background-color: #1e1e1e;
      height: 100vh;
      padding: 1rem;
    }
    .sidebar a {
      color: white;
      display: block;
      margin-bottom: 1rem;
      text-decoration: none;
    }
    .sidebar a:hover {
      color: #00bcd4;
    }
    video, audio {
      width: 100%;
      max-height: 400px;
      background: black;
    }
    .playlist {
      max-height: 300px;
      overflow-y: auto;
    }
    .channel-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .channel-info img {
      width: 60px;
      height: 60px;
      object-fit: contain;
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-3 sidebar">
        <h4>Kategoriler</h4>
        <a href="#" onclick="loadCategory('radyo')"><i class="fa fa-music"></i> Radyo</a>
        <a href="#" onclick="loadCategory('tv')"><i class="fa fa-tv"></i> TV</a>
        <a href="#" onclick="loadCategory('spor')"><i class="fa fa-futbol"></i> Spor</a>
        <a href="#" onclick="loadCategory('film')"><i class="fa fa-film"></i> Film</a>
        <a href="#" onclick="loadCategory('genel')"><i class="fa fa-th"></i> Genel</a><div class="mt-4">
      <h6>Dış Yayın Ekle</h6>
      <input type="url" id="streamUrl" class="form-control mb-2" placeholder="Yayın URL (.m3u8 veya .mp3)">
      <input type="file" id="playlistFile" class="form-control mb-2" accept=".m3u,.txt">
      <button class="btn btn-success w-100" onclick="loadExternalStream()">Yükle / Oynat</button>
      <button class="btn btn-danger w-100 mt-2" onclick="clearSavedStreams()">Kayıtları Temizle</button>
    </div>
  </div>

  <div class="col-md-9 p-4">
    <div class="channel-info">
      <img id="channelLogo" src="" alt="Kanal Logosu">
      <div>
        <h5 id="channelTitle">Seçili Yayın</h5>
        <span id="streamStatus" class="badge bg-secondary">Durum: Bağlanıyor...</span>
      </div>
    </div>

    <div id="mediaPlayer">
      <audio id="audioPlayer" controls style="display:none;"></audio>
      <video id="videoPlayer" controls style="display:none;"></video>
    </div>

    <h5 class="mt-4">Çalma Listesi</h5>
    <div class="playlist list-group" id="playlist"></div>
  </div>
</div>

  </div>  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>  <script>
    const playlistData = {
      radyo: [
        { title: 'Radyo Fenomen', url: 'https://example.com/fenomen.mp3', logo: 'https://via.placeholder.com/60x60.png?text=Fenomen' }
      ],
      tv: [
        { title: 'TRT 1', url: 'https://trt1.m3u8', logo: 'https://via.placeholder.com/60x60.png?text=TRT1' },
        { title: 'Show TV', url: 'https://showtv.m3u8', logo: 'https://via.placeholder.com/60x60.png?text=Show' }
      ],
      spor: [],
      film: [],
      genel: []
    };

    let currentPlaylist = [];
    let currentIndex = 0;
    let hls;

    function loadCategory(category) {
      document.getElementById('playlist').innerHTML = '';
      currentPlaylist = playlistData[category] || [];
      currentIndex = 0;
      currentPlaylist.forEach((item, index) => addToPlaylist(item, index));
      if (currentPlaylist.length > 0) playMedia(currentPlaylist[0]);
    }

    function addToPlaylist(item, index = null) {
      const el = document.createElement('a');
      el.href = '#';
      el.className = 'list-group-item list-group-item-action d-flex align-items-center';
      el.innerHTML = `<img src="${item.logo}" class="me-2" style="width:30px; height:30px;"> ${item.title}`;
      el.onclick = () => {
        currentIndex = index ?? 0;
        playMedia(item);
      };
      document.getElementById('playlist').appendChild(el);
    }

    function updateChannelInfo(item) {
      document.getElementById('channelTitle').innerText = item.title;
      document.getElementById('channelLogo').src = item.logo;
      setStatus('Bağlanıyor...', 'bg-secondary');
    }

    function setStatus(text, colorClass) {
      const el = document.getElementById('streamStatus');
      el.innerText = `Durum: ${text}`;
      el.className = `badge ${colorClass}`;
    }

    function handleStreamError() {
      setStatus('Bağlantı Hatası', 'bg-danger');
      if (currentIndex + 1 < currentPlaylist.length) {
        currentIndex++;
        playMedia(currentPlaylist[currentIndex]);
      } else {
        alert("Tüm yayınlar başarısız.");
      }
    }

    function playMedia(item) {
      const video = document.getElementById('videoPlayer');
      const audio = document.getElementById('audioPlayer');

      video.style.display = 'none';
      audio.style.display = 'none';
      video.pause();
      audio.pause();
      if (hls) { hls.destroy(); hls = null; }

      updateChannelInfo(item);

      if (item.url.endsWith('.mp3')) {
        audio.style.display = 'block';
        audio.src = item.url;
        audio.play().then(() => setStatus('Online', 'bg-success')).catch(() => handleStreamError());
        setTimeout(() => {
          if (audio.paused || audio.networkState === 3) handleStreamError();
        }, 6000);
      } else {
        video.style.display = 'block';
        if (Hls.isSupported()) {
          hls = new Hls();
          hls.loadSource(item.url);
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED, () => video.play().then(() => setStatus('Online', 'bg-success')).catch(() => handleStreamError()));
          hls.on(Hls.Events.ERROR, (ev, data) => { if (data.fatal) handleStreamError(); });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = item.url;
          video.play().then(() => setStatus('Online', 'bg-success')).catch(() => handleStreamError());
        } else {
          handleStreamError();
        }

        setTimeout(() => {
          if (video.readyState < 2 || video.paused || video.networkState === 3) handleStreamError();
        }, 7000);
      }
    }

    function saveToLocal(stream) {
      let saved = JSON.parse(localStorage.getItem('savedStreams') || '[]');
      saved.push(stream);
      localStorage.setItem('savedStreams', JSON.stringify(saved));
      loadSavedStreams();
    }

    function loadExternalStream() {
      const url = document.getElementById('streamUrl').value;
      const file = document.getElementById('playlistFile').files[0];

      if (url) {
        const stream = { title: 'Dış Yayın', url, logo: 'https://via.placeholder.com/60x60.png?text=Yayın' };
        saveToLocal(stream);
        playMedia(stream);
      } else if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const lines = e.target.result.split('\n').filter(line => line && !line.startsWith('#'));
          lines.forEach((line, i) => {
            const stream = { title: `Yüklenen ${i + 1}`, url: line.trim(), logo: 'https://via.placeholder.com/60x60.png?text=Dosya' };
            saveToLocal(stream);
          });
          if (lines.length > 0) playMedia({ title: 'Yüklenen Yayın', url: lines[0], logo: 'https://via.placeholder.com/60x60.png?text=Dosya' });
        };
        reader.readAsText(file);
      } else {
        alert('Yayın URL girin veya dosya seçin.');
      }
    }

    function loadSavedStreams() {
      const saved = JSON.parse(localStorage.getItem('savedStreams') || '[]');
      document.getElementById('playlist').innerHTML = '';
      saved.forEach((item, index) => addToPlaylist(item, index));
    }

    function clearSavedStreams() {
      if (confirm("Tüm kayıtlı yayınları silmek istiyor musunuz?")) {
        localStorage.removeItem('savedStreams');
        document.getElementById('playlist').innerHTML = '';
      }
    }

    window.onload = () => {
      const saved = JSON.parse(localStorage.getItem('savedStreams') || '[]');
      if (saved.length > 0) {
        loadSavedStreams();
        playMedia(saved[0]);
      } else {
        loadCategory('tv');
      }
    }
  </script></body>
</html>
