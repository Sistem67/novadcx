<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MİV1 Player - Güncel Sürüm</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root {
            --primary: #2563eb;
            --danger: #dc2626;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: grid;
            grid-template-columns: 250px 1fr;
            grid-template-rows: auto 1fr auto;
            height: 100vh;
            background: #0f172a;
            color: var(--light);
        }
        
        /* Kanal Listesi */
        #channel-list {
            grid-column: 1;
            grid-row: 2;
            overflow-y: auto;
            background: var(--dark);
            border-right: 1px solid #334155;
        }
        
        .channel-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #334155;
        }
        
        .channel-item:hover {
            background: #1e3a8a;
        }
        
        .channel-logo {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            object-fit: contain;
        }
        
        /* Player Alanı */
        #player-container {
            grid-column: 2;
            grid-row: 1 / span 2;
            position: relative;
            background: #000;
        }
        
        #video-player {
            width: 100%;
            height: 100%;
        }
        
        /* Playlist Yöneticisi */
        #playlist-manager {
            grid-column: 1 / span 2;
            grid-row: 3;
            background: var(--dark);
            padding: 10px;
            border-top: 1px solid #334155;
            display: flex;
            gap: 10px;
        }
        
        .playlist-btn {
            padding: 8px 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .playlist-btn.delete {
            background: var(--danger);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            body {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }
            #channel-list, #player-container {
                grid-column: 1;
            }
            #channel-list {
                grid-row: 1;
                height: 150px;
                border-right: none;
                border-bottom: 1px solid #334155;
            }
        }
    </style>
</head>
<body>
    <!-- Kanal Listesi -->
    <div id="channel-list">
        <div id="channel-count">0 Kanal Yüklü</div>
        <!-- Kanallar buraya eklenecek -->
    </div>
    
    <!-- Video Player -->
    <div id="player-container">
        <video id="video-player" controls></video>
    </div>
    
    <!-- Playlist Yöneticisi -->
    <div id="playlist-manager">
        <input type="file" id="playlist-input" accept=".m3u,.m3u8" style="display:none">
        <button class="playlist-btn" id="load-btn"><i class="fas fa-folder-open"></i> Playlist Yükle</button>
        <button class="playlist-btn delete" id="delete-btn"><i class="fas fa-trash"></i> Playlist Sil</button>
        <button class="playlist-btn" id="refresh-btn"><i class="fas fa-sync-alt"></i> Yenile</button>
    </div>

    <script>
        // DOM Elementleri
        const videoPlayer = document.getElementById('video-player');
        const channelList = document.getElementById('channel-list');
        const channelCount = document.getElementById('channel-count');
        const loadBtn = document.getElementById('load-btn');
        const deleteBtn = document.getElementById('delete-btn');
        const refreshBtn = document.getElementById('refresh-btn');
        const playlistInput = document.getElementById('playlist-input');
        
        // HLS.js için örnek oluşturma
        let hls = new Hls();
        
        // Kanal listesi
        let channels = [];
        let currentPlaylist = null;
        
        // Playlist yükleme
        loadBtn.addEventListener('click', () => {
            playlistInput.click();
        });
        
        playlistInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    currentPlaylist = file.name;
                    parseM3U(event.target.result);
                    updateChannelList();
                };
                reader.readAsText(file);
            }
        });
        
        // Playlist silme
        deleteBtn.addEventListener('click', () => {
            if (confirm('Playlist silinecek, emin misiniz?')) {
                channels = [];
                currentPlaylist = null;
                updateChannelList();
                videoPlayer.src = '';
            }
        });
        
        // Yenileme butonu
        refreshBtn.addEventListener('click', () => {
            if (channels.length > 0) {
                playChannel(0); // İlk kanalı tekrar yükle
            }
        });
        
        // M3U Parser
        function parseM3U(content) {
            channels = [];
            const lines = content.split('\n');
            let currentChannel = {};
            
            lines.forEach(line => {
                line = line.trim();
                
                if (line.startsWith('#EXTINF:')) {
                    const info = line.substring(8).split(',');
                    const params = info[0].split(' ');
                    
                    currentChannel = {
                        name: info.slice(1).join(',').trim(),
                        group: ''
                    };
                    
                    params.forEach(param => {
                        if (param.startsWith('group-title=')) {
                            currentChannel.group = param.substring(12).replace(/"/g, '');
                        } else if (param.startsWith('tvg-logo=')) {
                            currentChannel.logo = param.substring(9).replace(/"/g, '');
                        }
                    });
                } else if (line && !line.startsWith('#') && line.startsWith('http')) {
                    currentChannel.url = line;
                    channels.push(currentChannel);
                }
            });
        }
        
        // Kanal listesini güncelleme
        function updateChannelList() {
            channelList.innerHTML = '';
            channelCount.textContent = `${channels.length} Kanal Yüklü`;
            
            if (channels.length === 0) {
                channelList.innerHTML = '<div style="padding:15px;text-align:center;">Playlist yükleyin</div>';
                return;
            }
            
            channels.forEach((channel, index) => {
                const channelItem = document.createElement('div');
                channelItem.className = 'channel-item';
                channelItem.innerHTML = `
                    <img src="${channel.logo || 'https://via.placeholder.com/30'}" class="channel-logo" alt="${channel.name}">
                    <span>${channel.name}</span>
                `;
                channelItem.addEventListener('click', () => playChannel(index));
                channelList.appendChild(channelItem);
            });
            
            // İlk kanalı otomatik oynat
            if (channels.length > 0) {
                playChannel(0);
            }
        }
        
        // Kanal oynatma
        function playChannel(index) {
            const channel = channels[index];
            
            if (channel.url.includes('.m3u8')) {
                // HLS akışı
                if (Hls.isSupported()) {
                    hls.loadSource(channel.url);
                    hls.attachMedia(videoPlayer);
                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        videoPlayer.play();
                    });
                } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    // Safari için native destek
                    videoPlayer.src = channel.url;
                    videoPlayer.play();
                } else {
                    alert('Tarayıcınız bu akış formatını desteklemiyor');
                }
            } else {
                // Direkt video
                videoPlayer.src = channel.url;
                videoPlayer.play();
            }
            
            // Seçili kanalı vurgula
            document.querySelectorAll('.channel-item').forEach(item => {
                item.style.background = 'transparent';
            });
            document.querySelectorAll('.channel-item')[index].style.background = '#1e3a8a';
        }
        
        // Hata yönetimi
        videoPlayer.addEventListener('error', () => {
            console.error('Oynatıcı hatası:', videoPlayer.error);
            alert('Yayın açılamadı. Sonraki kanala geçiliyor...');
            const currentIndex = channels.findIndex(c => c.url === videoPlayer.src);
            if (currentIndex < channels.length - 1) {
                playChannel(currentIndex + 1);
            }
        });
        
        // Başlangıçta boş liste göster
        updateChannelList();
    </script>
</body>
</html>
